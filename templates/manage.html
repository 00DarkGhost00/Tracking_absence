{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
    <div class="mb-4">
        <h2 class="fw-bold text-navy"><i class="fas fa-cogs me-2"></i>Paramètres du Système</h2>
        <p class="text-muted">Configuration de l'environnement académique et gestion des bases de données.</p>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-xl-6">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="fw-bold text-navy mb-0"><i class="far fa-calendar-alt me-2"></i>Période du Semestre</h5>
                </div>
                <div class="card-body p-4 bg-light">
                    <form method="POST">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase">Date de début</label>
                                <input type="date" name="sem_start" class="form-control" value="{{ s }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small text-uppercase">Date de fin</label>
                                <input type="date" name="sem_end" class="form-control" value="{{ e }}" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-navy w-100 fw-bold">
                            <i class="fas fa-save me-2"></i>Enregistrer les dates
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-xl-6">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="fw-bold text-navy mb-0"><i class="fas fa-file-csv me-2"></i>Importer l'Emploi du Temps</h5>
                </div>
                <div class="card-body p-4 bg-light d-flex flex-column justify-content-center">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label class="form-label fw-bold text-muted small text-uppercase">Nouveau fichier Database.csv</label>
                            <input type="file" name="file" class="form-control" accept=".csv" required>
                        </div>
                        <button type="submit" class="btn btn-outline-navy w-100 fw-bold">
                            <i class="fas fa-sync-alt me-2"></i>Mettre à jour la base
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mb-5">
        <div class="card-header bg-white border-bottom py-3">
            <h5 class="fw-bold text-navy mb-0"><i class="fas fa-database me-2"></i>Sauvegarde & Restauration</h5>
        </div>
        <div class="card-body p-0">
            <div class="row g-0">
                <div class="col-md-6 border-end p-4">
                    <h6 class="fw-bold text-dark mb-2">1. Exporter les données</h6>
                    <p class="text-muted small mb-3">Téléchargez une copie complète de la base de données (absences, rattrapages, professeurs).</p>
                    <a href="{{ url_for('export_db') }}" class="btn btn-outline-secondary btn-sm fw-bold">
                        <i class="fas fa-download me-2"></i>Télécharger Backup (.db)
                    </a>
                </div>
                
                <div class="col-md-6 p-4">
                    <h6 class="fw-bold text-dark mb-2">2. Restaurer un point de sauvegarde</h6>
                    <p class="text-muted small mb-3">Remplacez toutes les données actuelles par un fichier de sauvegarde précédent.</p>
                    <form action="{{ url_for('restore_db') }}" method="POST" enctype="multipart/form-data" onsubmit="return confirm('Attention : Cela écrasera TOUTES les données actuelles. Continuer ?');">
                        <div class="input-group input-group-sm">
                            <input type="file" name="backup_file" class="form-control" accept=".db" required>
                            <button class="btn btn-secondary fw-bold" type="submit">Restaurer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-danger mb-4">
        <div class="card-header bg-danger text-white py-3">
            <h5 class="fw-bold mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Zone de Danger - Fin de Semestre</h5>
        </div>
        <div class="card-body p-4 bg-white">
            <p class="text-dark mb-3">
                Utilisez cette fonction uniquement à la transition entre deux semestres. Cette action <strong>effacera définitivement</strong> l'emploi du temps, les absences et les rattrapages actuels.
            </p>
            <div class="alert alert-warning py-2 mb-4">
                <i class="fas fa-info-circle me-2"></i><strong>Conseil :</strong> Sauvegardez un Backup (.db) avant de continuer.
            </div>
            <form action="{{ url_for('reset_semester') }}" method="POST" onsubmit="return confirm('Êtes-vous ABSOLUMENT SÛR ? Cette action est irréversible.');">
                <button type="submit" class="btn btn-danger fw-bold">
                    <i class="fas fa-trash-alt me-2"></i>Réinitialiser l'application
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .text-navy { color: #002b5e !important; }
    .bg-navy { background-color: #002b5e !important; }
    .btn-navy { background-color: #002b5e; color: #ffffff; border: none; }
    .btn-navy:hover { background-color: #001a38; color: #ffffff; }
    .btn-outline-navy { color: #002b5e; border: 1px solid #002b5e; background-color: transparent; }
    .btn-outline-navy:hover { background-color: #002b5e; color: #ffffff; }
</style>
{% endblock %}