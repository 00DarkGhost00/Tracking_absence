{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
    <div class="mb-4">
        <h2 class="fw-bold text-navy"><i class="fas fa-calendar-times me-2"></i>Jours Exceptionnels</h2>
        <p class="text-muted">Déclarez les périodes de vacances, jours fériés ou grèves. Les séances tombant dans ces périodes seront ignorées.</p>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-xl-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="fw-bold text-navy mb-0"><i class="fas fa-plus-circle me-2"></i>Ajouter une Période</h5>
                </div>
                <div class="card-body p-4 bg-light">
                    <form method="POST" action="{{ url_for('manage_holidays') }}">
                        
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label fw-bold text-muted small text-uppercase">Du (Début)</label>
                                <input type="date" id="dateStart" name="date_start" class="form-control" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold text-muted small text-uppercase">Au (Fin)</label>
                                <input type="date" id="dateEnd" name="date_end" class="form-control" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold text-muted small text-uppercase">Type d'arrêt</label>
                            <select name="type_holiday" class="form-select fw-bold" required>
                                <option value="Férié">Jour Férié (1 jour)</option>
                                <option value="Vacances">Vacances Universitaires</option>
                                <option value="Grève">Grève / Force Majeure</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold text-muted small text-uppercase">Description (Motif)</label>
                            <input type="text" name="description" class="form-control" placeholder="ex: Vacances du Printemps..." required>
                        </div>
                        <button type="submit" class="btn btn-navy w-100 fw-bold">
                            <i class="fas fa-save me-2"></i>Enregistrer la période
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-xl-8">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold text-navy mb-0"><i class="fas fa-list me-2"></i>Périodes Bloquées</h5>
                    <span class="badge bg-navy text-white rounded-pill">{{ holidays|length }} périodes</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light text-muted small text-uppercase" style="position: sticky; top: 0; z-index: 1;">
                                <tr>
                                    <th class="py-3 ps-4 fw-bold">Date / Période</th>
                                    <th class="py-3 fw-bold">Type</th>
                                    <th class="py-3 fw-bold w-50">Motif</th>
                                    <th class="py-3 text-end pe-4 fw-bold">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for h in holidays %}
                                <tr>
                                    <td class="ps-4 fw-bold text-dark" style="font-size: 0.9rem;">
                                        {% if h['date_start'] == h['date_end'] %}
                                            <i class="far fa-calendar-day text-muted me-2"></i> Le {{ h['date_start'] }}
                                        {% else %}
                                            <i class="far fa-calendar-alt text-muted me-2"></i> Du {{ h['date_start'] }} au {{ h['date_end'] }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if h['type_holiday'] == 'Férié' %}
                                            <span class="badge bg-success bg-opacity-10 text-success border border-success px-2 py-1"><i class="fas fa-star me-1"></i>Férié</span>
                                        {% elif h['type_holiday'] == 'Vacances' %}
                                            <span class="badge bg-info bg-opacity-10 text-info border border-info px-2 py-1"><i class="fas fa-sun me-1"></i>Vacances</span>
                                        {% else %}
                                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger px-2 py-1"><i class="fas fa-exclamation-triangle me-1"></i>Grève</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-muted">{{ h['description'] }}</td>
                                    <td class="text-end pe-4">
                                        <form action="{{ url_for('delete_holiday', h_id=h['id']) }}" method="POST" onsubmit="return confirm('Voulez-vous vraiment supprimer cette période exceptionnelle ?');" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-danger px-3 rounded-pill" title="Supprimer">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-5 text-muted">
                                        <div class="opacity-25 mb-2"><i class="far fa-calendar-check fa-3x"></i></div>
                                        <span>Aucune période n'est bloquée actuellement.</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .text-navy { color: #002b5e !important; }
    .bg-navy { background-color: #002b5e !important; }
    .btn-navy { background-color: #002b5e; color: #ffffff; border: none; }
    .btn-navy:hover { background-color: #001a38; color: #ffffff; }
    
    .table-responsive::-webkit-scrollbar { width: 6px; }
    .table-responsive::-webkit-scrollbar-track { background: #f8f9fa; }
    .table-responsive::-webkit-scrollbar-thumb { background: #dee2e6; border-radius: 3px; }
</style>

<script>
    // Autofill de la date de fin = date de début pour gagner du temps
    document.getElementById('dateStart').addEventListener('change', function() {
        let dateEnd = document.getElementById('dateEnd');
        if (!dateEnd.value) {
            dateEnd.value = this.value;
        }
    });
</script>


{% endblock %}